<script src="./product_data.js" type="text/javascript"></script>
<script>
  //i took this from Ports Example in Part B of Assignment 1 
  // 
  let params = (new URL(document.location)).searchParams; //
  var quantities = [];
  // form was submitted so process the invoice
  if (params.has('purchase_submit')) { //
    for (i = 0; i < products.length; i++) { //
      if (params.has(`quantity${i}`)) { //
        a_qty = params.get(`quantity${i}`); //
        quantities[i] = a_qty; //
      }
    }
  } else {
    document.write('no form submitted'); //
  }
  console.log(quantities);
</script>

<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Cart</title>
  <link href="product-style.css" rel="stylesheet">
</head>

<body>
    <div class=container5> 
      <br><b>Your Cart</b>
    </div>
  <table border="2" align="center">  
    <tbody>
      <tr>
        <th style="text-align: center;" width="43%">Item</th>
        <th style="text-align: center;" width="11%">Quantity</th>
        <th style="text-align: center;" width="13%">Price</th>
        <th style="text-align: center;" width="54%">Extended Price</th>
      </tr>

      <script>
        subtotal = 0;
        for (i = 0; i < products.length; i++) {
          if (quantities[i] > 0) {
            // product row
            extended_price = quantities[i] * products[i].price
            subtotal += extended_price;
            document.write(`
      <tr>
        <td width="43%" style= "text-align: center;">${products[i].item}</td>
        <td align="center" width="11%">${quantities[i]}</td>
        <td width="13%" style="text-align: center;">\$${products[i].price}</td>
        <td width="54%" style="text-align: center;">\$${extended_price}</td>
      </tr>
      `);
          }
        }
        // Compute tax
        var tax_rate = 0.04;
        var tax = tax_rate * subtotal;

        // Compute shipping
        if (subtotal <= 200) {
          shipping = 20;
        }
        else if (subtotal <= 500) {
          shipping = 10;
        }
        else if (subtotal > 500) {
          shipping = 0;
        }

        // Compute grand total
        var total = subtotal + tax + shipping;


      </script>

        <tr>
          <td colspan="4" width="100%">&nbsp;</td>
        </tr>
        <tr>
          <td style="text-align: center;" colspan="3" width="67%">Sub-total</td>
          <td width="54%" style="text-align: center;">$
            <script>document.write(subtotal);</script>
          </td>
        </tr>
        <tr>
          <td style="text-align: center;" colspan="3" width="67%"> Tax @
            <script>document.write(100 * tax_rate);</script>%</span></td>
          <td width="54%" style="text-align: center;">$
            <script>document.write(tax.toFixed(2));</script>
          </td>
        </tr>
        <tr>
          <td style="text-align: center;" colspan="3" width="67%">Shipping</span></td>
          <td width="54%" style="text-align: center;">$
            <script>document.write(shipping.toFixed(2));</script>
          </td>
        </tr>
        <tr>
          <td style="text-align: center;" colspan="3" width="67%"><strong>Total</strong></td>
          <td width="54%" style="text-align: center;"><strong>$
              <script>document.write(total.toFixed(2));</script></strong></td>
        </tr>
    </tbody>
 
  </table> 


  <div class=container4>
    <br><b>
      OUR SHIPPING POLICY IS:
      <br> A subtotal $0 - $199.99 will be $20 shipping
      <br> A subtotal $200.00 - $499.99 will be $10 shipping
      <br> Subtotals over $500 will have free shipping
    </b> </div>
</body>